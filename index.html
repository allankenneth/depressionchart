<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Depression Graph</title>
  <meta name="description" content="Depression Graph: Keep track of your major depression inventories. Track, share, get better.">
  <meta name="author" content="Allan Haggett">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/bootstrap.min.css">

  <style>
  body {padding: 6em 0; position: relative;}
  label {color: #666; display: block;}
  .nav-link {padding: .3em;}
  .question {margin: 3em 0;}
  .questiontext {font-size: 1.6em; font-weight: 200; margin: 0 0 .5em 0;}
  </style>
</head>
<body class="fade-in">

  <nav id="inventory-questions" class="navbar fixed-top navbar-light bg-faded">
    <span class="navbar-brand">Depression Graph</span>
  </nav>
<div class="container">
<div class="row justify-content-md-center">
	<div class="col-md-8">
<div class="jumbotron">
<a href="questionnaire.html" class="bounce-top btn btn-primary btn-lg btn-block">Answer the Questions</a>
<hr>
<div id="chart"></div>
<div class="results"></div>

</div>
</div>
	<div class="col-md-4">
		<h1>The Idea</h1>
		<p><a href="questionnaire.html">Answer these 14 questions</a>, and your device stores your assessment. Come back in two weeks and take the test again. Your device remembers your previous scores and as you keep taking the test a graph emerges that shows your assessments and how they've evolved over time. Note that your information is not transmitted over a network; your assessment is calculated on your device and is stored there too. <a href="https://github.com/allankenneth/depressiongraph2">The source code is on Github</a>, and is <a href="https://allankenneth.com">made by Allan</a>, based on the <a href="https://en.wikipedia.org/wiki/Major_Depression_Inventory">Major Depression Inventory</a>.</p>
	</div>
<div>
</div> <!-- /.container -->
<hr>
<script src="/jquery.min.js"></script>
<script src="/tether.min.js"></script>
<script src="/bootstrap.min.js"></script>
<script src="/pouchdb.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

<script>

</script>
<script>
$(document).ready(function(){








var html = '';
var count = 0;
var timeseries = [];
var inventories = [];
var scores = [];
var dates = [];

var barColors = [];
var extremeColor = '#D9534F';
var moderateColor = '#F0AD4E';
var mildColor = '#5CB85C';
var barColor = '';

var db = new PouchDB('inventories');
db.allDocs({include_docs: true, descending: true}, function(err, doc) {
	doc.rows.forEach(function(e,index){
		d = new Date(parseInt(e.doc['date'])).toDateString();
		total = e.doc['score'];
		level = "bg-success";
		if(total>=20 && total<25) {
			level = "bg-warning";
		}
		if(total>=25 && total<30) {
			level = "bg-danger";
		}
		if(total>=30) {
			level = "bg-inverse";
		}
		width = parseInt(total) * 10;
		html += '<div style="width:' + width  + 'px;" class="assessment p-2 text-white '+ level +'">';
		html += '<a class="invdel float-left mt-2 mr-2 mb-0 mr-0" href="#'+parseInt(e.doc['date'])+'" style="color:#FFF">x</a>';
		html += '<span class="score float-right" style="height: 40px; width: 40px; padding: 10px 20p 5px 0x; font-size: 24px; text-align: center;">' + total + '</span>';
		html += '<small>' + d  + '<br>' + e.doc['diagnoses'] + '</small>';
		html += '</div>';
		barColors.push(barColor);
		timeseries.push({x: parseInt(e.doc['date']), y: e.doc['score']});
		dates.push(d);
		scores.push(e.doc['score']);
		count++;
	});
	if(count==0) html = '';
	//$('.results').html(html);
	inventories = JSON.stringify(timeseries);
	inventories = inventories.replace(/\"([^(\")"]+)\":/g,"$1:");

});


console.log(scores);


var options = {
            chart: {
                height: 350,
                type: 'line',
                shadow: {
                    enabled: true,
                    color: '#000',
                    top: 18,
                    left: 7,
                    blur: 10,
                    opacity: 1
                },
                toolbar: {
                    show: false
                }
            },
            colors: ['#77B6EA', '#545454'],
            dataLabels: {
                enabled: true,
            },
            stroke: {
                curve: 'smooth'
            },
            series: [{
                    name: "High - 2013",
                    data: [20,30,40]
                }
            ],
            title: {
                text: 'Average High & Low Temperature',
                align: 'left'
            },
            grid: {
                borderColor: '#e7e7e7',
                row: {
                    colors: ['#f3f3f3', 'transparent'], // takes an array which will be repeated on columns
                    opacity: 0.5
                },
            },
            markers: {
                style: 'inverted',
                size: 6
            },
            xaxis: {
                categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                title: {
                    text: 'Month'
                }
            },
            yaxis: {
                title: {
                    text: 'Temperature'
                },
                min: 5,
                max: 40
            },
            legend: {
                position: 'top',
                horizontalAlign: 'right',
                floating: true,
                offsetY: -25,
                offsetX: -5
            }
        }

        var chart = new ApexCharts(
            document.querySelector("#chart"),
            options
        );

        chart.render();


















$('body').on('click','a.invdel',function(e){
	e.preventDefault();
	mydoc = $(this).attr('href');
	docid = mydoc.split('#');
	did = docid[1];
	db.get(did).then(function (doc) {
	  return db.remove(doc);
	});
	$(this).parents('.assessment').remove();
});

});
</script>
</body>
</html>
