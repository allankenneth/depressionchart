<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Depression Graph</title>
  <meta name="description" content="Depression Graph: Keep track of your major depression inventories. Track, share, get better.">
  <meta name="author" content="Allan Haggett">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/bootstrap.min.css">

  <style>
  body {padding: 6em 0; position: relative;}
  label {color: #666; display: block;}
  .nav-link {padding: .3em;}
  .question {margin: 3em 0;}
  .questiontext {font-size: 1.6em; font-weight: 200; margin: 0 0 .5em 0;}
.bounce-top {
	-webkit-animation: bounce-top 0.9s both;
	        animation: bounce-top 0.9s both;
}
/* ----------------------------------------------
 * Generated by Animista on 2017-5-30 20:44:2
 * w: http://animista.net, t: @cssanimista
 * ---------------------------------------------- */

/**
 * ----------------------------------------
 * animation bounce-top
 * ----------------------------------------
 */
@-webkit-keyframes bounce-top {
  0% {
    -webkit-transform: translateY(-45px);
            transform: translateY(-45px);
    -webkit-animation-timing-function: ease-in;
            animation-timing-function: ease-in;
    opacity: 1;
  }
  24% {
    opacity: 1;
  }
  40% {
    -webkit-transform: translateY(-24px);
            transform: translateY(-24px);
    -webkit-animation-timing-function: ease-in;
            animation-timing-function: ease-in;
  }
  65% {
    -webkit-transform: translateY(-12px);
            transform: translateY(-12px);
    -webkit-animation-timing-function: ease-in;
            animation-timing-function: ease-in;
  }
  82% {
    -webkit-transform: translateY(-6px);
            transform: translateY(-6px);
    -webkit-animation-timing-function: ease-in;
            animation-timing-function: ease-in;
  }
  93% {
    -webkit-transform: translateY(-4px);
            transform: translateY(-4px);
    -webkit-animation-timing-function: ease-in;
            animation-timing-function: ease-in;
  }
  25%,
  55%,
  75%,
  87% {
    -webkit-transform: translateY(0px);
            transform: translateY(0px);
    -webkit-animation-timing-function: ease-out;
            animation-timing-function: ease-out;
  }
  100% {
    -webkit-transform: translateY(0px);
            transform: translateY(0px);
    -webkit-animation-timing-function: ease-out;
            animation-timing-function: ease-out;
    opacity: 1;
  }
}
@keyframes bounce-top {
  0% {
    -webkit-transform: translateY(-45px);
            transform: translateY(-45px);
    -webkit-animation-timing-function: ease-in;
            animation-timing-function: ease-in;
    opacity: 1;
  }
  24% {
    opacity: 1;
  }
  40% {
    -webkit-transform: translateY(-24px);
            transform: translateY(-24px);
    -webkit-animation-timing-function: ease-in;
            animation-timing-function: ease-in;
  }
  65% {
    -webkit-transform: translateY(-12px);
            transform: translateY(-12px);
    -webkit-animation-timing-function: ease-in;
            animation-timing-function: ease-in;
  }
  82% {
    -webkit-transform: translateY(-6px);
            transform: translateY(-6px);
    -webkit-animation-timing-function: ease-in;
            animation-timing-function: ease-in;
  }
  93% {
    -webkit-transform: translateY(-4px);
            transform: translateY(-4px);
    -webkit-animation-timing-function: ease-in;
            animation-timing-function: ease-in;
  }
  25%,
  55%,
  75%,
  87% {
    -webkit-transform: translateY(0px);
            transform: translateY(0px);
    -webkit-animation-timing-function: ease-out;
            animation-timing-function: ease-out;
  }
  100% {
    -webkit-transform: translateY(0px);
            transform: translateY(0px);
    -webkit-animation-timing-function: ease-out;
            animation-timing-function: ease-out;
    opacity: 1;
  }
}
.fade-in {
	-webkit-animation: fade-in 1.2s cubic-bezier(0.390, 0.575, 0.565, 1.000) both;
	        animation: fade-in 1.2s cubic-bezier(0.390, 0.575, 0.565, 1.000) both;
}

/**
 * ----------------------------------------
 * animation fade-in
 * ----------------------------------------
 */
@-webkit-keyframes fade-in {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
@keyframes fade-in {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}

  </style>
</head>
<body class="fade-in">

  <nav id="inventory-questions" class="navbar fixed-top navbar-light bg-faded">
    <span class="navbar-brand">Depression Graph</span>
  </nav>
<div class="container">
<div class="jumbotron">
<a href="questionnaire.html" class="bounce-top btn btn-primary btn-lg btn-block">Take the Test*</a>
<div id="chart"></div>
<div class="results"></div>
</div>
<div class="row">
	<div class="col-md-12">
		<h1>The Idea</h1>
		<p><a href="questionnaire.html">Take the test</a>, and your device stores your score on your device. Come back in two weeks and take the test again. Your device remembers your previous scores and as you keep taking the test a graph emerges that shows your assessments and how they've evolved over time. Note that your information is not transmitted over a network; your assessment is calculated on your device and is stored on your device.</p>
		<p>* it's not a test; there is no pass or fail. It's an emotional inventory that's been designed to assess if what you've been feeling could be depression.</p>
	</div>
<div>
</div> <!-- /.container -->
<hr>
<script src="/jquery.min.js"></script>
<script src="/tether.min.js"></script>
<script src="/bootstrap.min.js"></script>
<script src="/pouchdb.min.js"></script>
<script src="/d3.v3.js"></script>
<script src="/rickshaw.min.js"></script>


<script>

</script>
<script>
$(document).ready(function(){

var html = '<hr><p>The graph part of this is not yet implemented; in the meantime, here is a table of your results to date:</p>';
html += '<table class="table"><tr><th></th><th>Date</th><th>Score</th><th>Diagnoses</th></tr>';
var count = 0;
var previnventories = [];
var db = new PouchDB('inventories');
db.allDocs({include_docs: true, descending: true}, function(err, doc) {
	doc.rows.forEach(function(e,index){
		d = new Date(parseInt(e.doc['date'])).toDateString();
		total = e.doc['score'];
		level = "btn-secondary";
		if(total>=20 && total<25) {
			level = "btn-success";
		}
		if(total>=25 && total<30) {
			level = "btn-warning";
		}
		if(total>=30) {
			level = "btn-danger";
		}

		html += '<tr><td><a class="invdel btn btn-sm btn-secondary" href="#'+parseInt(e.doc['date'])+'">x</a></td>';
		html += '<td>' + d + '</td><td><div class="btn '+ level +'">' + total + '</div></td><td>' + e.doc['diagnoses'] + '</td></tr>';
		previnventories.push({x: parseInt(e.doc['date']), y: e.doc['score']});
		count++;
	});
	html += '</table>';
	if(count==0) html = '';
	$('.results').html(html);
	inventories = JSON.stringify(previnventories);
	inventories = inventories.replace(/\"([^(\")"]+)\":/g,"$1:");
	console.log(inventories);
/*	var graph = new Rickshaw.Graph( {
				element: document.querySelector('#chart'), 
				width: 500, 
				height: 200, 
				renderer: 'line',
				series: [{
					color: 'steelblue',
					data: inventories
				}]
	});
	graph.render();
	var xAxis = new Rickshaw.Graph.Axis.Time({
	    graph: graph
	});
	xAxis.render();
*/
});
/*		data: [ 
		    { x: 0, y: 40 }, 
		    { x: 1, y: 49 }, 
		    { x: 2, y: 38 }, 
		    { x: 3, y: 30 }, 
		    { x: 4, y: 32 } ]
*/

$('body').on('click','a.invdel',function(e){
	e.preventDefault();
	mydoc = $(this).attr('href');
	docid = mydoc.split('#');
	did = docid[1];
	db.get(did).then(function (doc) {
	  return db.remove(doc);
	});
	$(this).parents('tr').remove();
});

});
</script>
</body>
</html>
